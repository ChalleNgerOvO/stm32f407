# STM32F4 触控屏和定时器项目

本项目演示了如何使用 STM32F4 微控制器与 3.5 英寸 TFT-LCD (ILI9486) 触控屏交互。同时，通过 TIM6 实现了基于定时器的延时功能。图形界面通过轻量级图形库 LVGL 实现，并在屏幕上显示一个可滑动的开关按钮。

---

## 项目功能
- **触控屏支持**：实现与 GUI 滑动开关的交互。
- **LVGL 集成**：使用轻量级图形库渲染图形组件。
- **基于定时器的延时**：使用 TIM6 实现精确的微秒和毫秒级延时。
- **模块化代码结构**：代码清晰组织，易于阅读和维护。

---

## 硬件要求
- **微控制器**：STM32F4 系列
- **显示屏**：3.5 英寸 TFT-LCD，使用 ILI9486 控制器
- **触控控制器**：支持的触控控制器（需提供驱动）
- **开发工具**：
  - Keil uVision（或等效的 IDE）
  - STM32 标准外设库

---

## 软件要求
- **LVGL（Light and Versatile Graphics Library）**：版本 8.x 或更高
- **STM32F4 标准外设库**
- **FreeRTOS**：实时操作系统

---

## 项目文件结构
```
Project/
├── Core/
│   ├── main.c                 // 主程序逻辑
│   ├── tim.c                  // TIM6 初始化和延时实现
│   ├── test_task.c            // LVGL 任务和 GUI 逻辑
│   ├── lv_port_disp_template.c // LVGL 显示驱动
│   ├── lv_port_indev_template.c // LVGL 输入驱动（触控屏）
│   ├── touch.c                // 触控屏处理逻辑
├── Middlewares/
│   ├── LVGL/                  // LVGL 库源码
├── Drivers/
│   ├── HAL/                   // STM32F4 外设 HAL/LL 驱动
│   ├── LCD/                   // ILI9486 驱动文件
│   ├── Touch/                 // 触控控制器驱动文件
├── README.md                  // 项目说明文档
```

---

## 快速开始

### 1. 克隆项目
```bash
git clone <https://github.com/ChalleNgerOvO/stm32f407>
cd Project/
```

### 2. 硬件连接
1. 将 3.5 英寸 TFT-LCD 显示屏通过 GPIO 与 STM32F4 开发板连接。
2. 确保触控控制器连接正确且已供电。
3. 将固件烧录到 STM32F4 微控制器。

### 3. 编译项目
1. 在 Keil uVision（或等效 IDE）中打开项目。
2. 确保项目包含 `stm32f4xx_tim.c` 等所需文件。
3. 编译并烧录项目到开发板。

---

## 使用方法

### 图形界面交互
1. 显示界面上有一个滑动开关按钮，位于屏幕中心。
2. 使用手指滑动触控屏上的开关按钮进行开关状态的切换。

### 代码亮点
#### 触控屏处理
- 触控控制器通过 `TP_Init()` 初始化。
- LVGL 输入驱动逻辑在 `lv_port_indev_template.c` 文件中实现。

#### 定时器延时
- `tim6_delay_us()` 和 `tim6_delay_ms()` 函数在 `tim.c` 中实现。
- TIM6 配置为提供精确延时功能，适用于 GUI 更新等需求。

#### FreeRTOS 任务
- 滑动开关按钮的渲染逻辑在 `test_task.c` 文件中实现。
- 任务通过 FreeRTOS 管理，确保实时响应。

---

## 常见问题

1. **触控屏无响应**：
   - 检查触控控制器与 STM32F4 开发板的连接是否正确。
   - 验证 `TP_Scan()` 是否能返回正确的触摸坐标。
2. **编译错误**：
   - 确保项目包含必要的库和驱动文件，例如 `stm32f4xx_tim.c`。
   - 检查项目设置中是否缺少相关路径或配置。
3. **界面不显示**：
   - 确认 `lv_port_disp_init()` 中显示驱动配置正确。
   - 检查 LCD 是否正确连接并供电。

---

## 未来改进
- 添加高级 GUI 组件支持，例如滑块、图表等。
- 实现多点触控或手势识别功能。
- 优化代码以适应内存受限的环境。

---

## 许可
本项目遵循 MIT 开源许可证。详情请查看 `LICENSE` 文件。

---
